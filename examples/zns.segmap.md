# zns.segmap

This shows example runs of `zns.segmap` on a F2FS file system. For acronyms and more information about definitions, see the man (running `man man/zns.segmap.8`).

## Example Run with Inlined Data

This contains dummy data from several RocksDB databases, and fio runs. We only show zone 2 and resolve inlined data extents.

```bash
user@stosys:~/src/zns-tools$ sudo ./src/zns.segmap -d /mnt/f2fs/ -z 2 -i
Warning: nvme0n1 is registered for this file system, however it is not a ZNS.
If it is used with F2FS as the conventional device, enter the assocaited ZNS device name: nvme0n2

====================================================================
                        SEGMENT MAPPINGS
====================================================================

============ ZONE 2 ============
LBAS: 0x400000  LBAE: 0x61a800  CAP: 0x21a800  WP: 0x404618  SIZE: 0x400000  STATE: 0x20  MASK: 0xffc00000

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 1024  PBAS: 0x400000    PBAE: 0x401000    SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x400150    PBAE: 0x400150    SIZE: 0           FILE:                                /mnt/f2fs//IDENTITY  EXTID:    1/1
***** EXTENT:  PBAS: 0x400158    PBAE: 0x400158    SIZE: 0           FILE:                                 /mnt/f2fs//CURRENT  EXTID:    1/1

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 1025  PBAS: 0x401000    PBAE: 0x402000    SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x401040    PBAE: 0x401040    SIZE: 0           FILE:                            /mnt/f2fs//db0/IDENTITY  EXTID:    1/1
***** EXTENT:  PBAS: 0x401048    PBAE: 0x401048    SIZE: 0           FILE:                             /mnt/f2fs//db0/CURRENT  EXTID:    1/1
```

As can be seen, all data in this zone has inlined data (not a coincidence, since zone 2 maps warm nodes).

## Example Run over a Range

We can also run over a specific range of zones, identifying what segments in these particular zones contain what file extents. We also only map a subdirectory of the mounted file system.

```bash
user@stosys:~/src/zns-tools$ sudo ./src/zns.segmap -d /mnt/f2fs/db0/ -s 4 -e 8
Warning: nvme0n1 is registered for this file system, however it is not a ZNS.
If it is used with F2FS as the conventional device, enter the assocaited ZNS device name: nvme0n2

====================================================================
                        SEGMENT MAPPINGS
====================================================================

============ ZONE 4 ============
LBAS: 0xc00000  LBAE: 0xe1a800  CAP: 0x21a800  WP: 0xd0c6e0  SIZE: 0x400000  STATE: 0x20  MASK: 0xffc00000

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 3072  PBAS: 0xc00000    PBAE: 0xc01000    SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0xc002f8    PBAE: 0xc00308    SIZE: 0x10        FILE:                      /mnt/f2fs/db0//OPTIONS-000007  EXTID:    1/1
***** EXTENT:  PBAS: 0xc00308    PBAE: 0xc00330    SIZE: 0x28        FILE:                                 /mnt/f2fs/db0//LOG  EXTID:    1/2

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 3146  PBAS: 0xc4a000    PBAE: 0xc4b000    SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0xc4a350    PBAE: 0xc4a358    SIZE: 0x8         FILE:                     /mnt/f2fs/db0//MANIFEST-000005  EXTID:    1/1
***** EXTENT:  PBAS: 0xc4a358    PBAE: 0xc4a368    SIZE: 0x10        FILE:                                 /mnt/f2fs/db0//LOG  EXTID:    2/2
--------------------------------------------------------------------------------------------------------------------------------------------

============ ZONE 8 ============
LBAS: 0x1c00000  LBAE: 0x1e1a800  CAP: 0x21a800  WP: 0x2000000  SIZE: 0x400000  STATE: 0xe0  MASK: 0xffc00000

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
>>>>> SEGMENT RANGE: 7168-7217   PBAS: 0x1c00000   PBAE: 0x1c32000   SIZE: 0x32000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x1c00000   PBAE: 0x1c32000   SIZE: 0x32000     FILE:                          /mnt/f2fs/db0//000009.sst  EXTID:    3/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 7218  PBAS: 0x1c32000   PBAE: 0x1c33000   SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x1c32000   PBAE: 0x1c32ff8   SIZE: 0xff8       FILE:                          /mnt/f2fs/db0//000009.sst  EXTID:    3/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 7543  PBAS: 0x1d77000   PBAE: 0x1d78000   SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x1d77ee0   PBAE: 0x1d78000   SIZE: 0x1000      FILE:                          /mnt/f2fs/db0//000009.sst  EXTID:    1/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
>>>>> SEGMENT RANGE: 7544-7705   PBAS: 0x1d78000   PBAE: 0x1e1a000   SIZE: 0xa2000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x1d78000   PBAE: 0x1e1a000   SIZE: 0xa2000     FILE:                          /mnt/f2fs/db0//000009.sst  EXTID:    1/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 7706  PBAS: 0x1e1a000   PBAE: 0x1e1b000   SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x1e1a000   PBAE: 0x1e1a800   SIZE: 0x800       FILE:                          /mnt/f2fs/db0//000009.sst  EXTID:    1/3
```

## Example Run over the entire Device

Since we only have a few GB written, we can write out all segments that we can map on the device. For contiguous segments that contain only a single file data, we depict these as `SEGMENT RANGE`, minimizing output.

```bash
user@stosys:~/src/zns-tools$ sudo ./src/zns.segmap -d /mnt/f2fs/
Warning: nvme0n1 is registered for this file system, however it is not a ZNS.
If it is used with F2FS as the conventional device, enter the assocaited ZNS device name: nvme0n2

====================================================================
                        SEGMENT MAPPINGS
====================================================================

============ ZONE 4 ============
LBAS: 0xc00000  LBAE: 0xe1a800  CAP: 0x21a800  WP: 0xd0c6e0  SIZE: 0x400000  STATE: 0x20  MASK: 0xffc00000

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 3072  PBAS: 0xc00000    PBAE: 0xc01000    SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0xc00030    PBAE: 0xc00040    SIZE: 0x10        FILE:                          /mnt/f2fs//OPTIONS-000007  EXTID:    1/1
***** EXTENT:  PBAS: 0xc00040    PBAE: 0xc000b8    SIZE: 0x78        FILE:                              /mnt/f2fs//000009.sst  EXTID:    1/1
***** EXTENT:  PBAS: 0xc000c8    PBAE: 0xc00140    SIZE: 0x78        FILE:                              /mnt/f2fs//000011.sst  EXTID:    1/1
***** EXTENT:  PBAS: 0xc00140    PBAE: 0xc00148    SIZE: 0x8         FILE:                              /mnt/f2fs//000012.sst  EXTID:    1/2
***** EXTENT:  PBAS: 0xc00158    PBAE: 0xc00168    SIZE: 0x10        FILE:                         /mnt/f2fs//MANIFEST-000004  EXTID:    1/1
***** EXTENT:  PBAS: 0xc00168    PBAE: 0xc001a8    SIZE: 0x40        FILE:                                     /mnt/f2fs//LOG  EXTID:    1/1
***** EXTENT:  PBAS: 0xc001a8    PBAE: 0xc00220    SIZE: 0x78        FILE:                          /mnt/f2fs//wal/000010.log  EXTID:    1/1
***** EXTENT:  PBAS: 0xc00220    PBAE: 0xc00228    SIZE: 0x8         FILE:                              /mnt/f2fs//000012.sst  EXTID:    2/2
***** EXTENT:  PBAS: 0xc00228    PBAE: 0xc002a0    SIZE: 0x78        FILE:                          /mnt/f2fs//wal/000013.log  EXTID:    1/1
***** EXTENT:  PBAS: 0xc002f8    PBAE: 0xc00308    SIZE: 0x10        FILE:                      /mnt/f2fs//db0/OPTIONS-000007  EXTID:    1/1
***** EXTENT:  PBAS: 0xc00308    PBAE: 0xc00330    SIZE: 0x28        FILE:                                 /mnt/f2fs//db0/LOG  EXTID:    1/2

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 3146  PBAS: 0xc4a000    PBAE: 0xc4b000    SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0xc4a350    PBAE: 0xc4a358    SIZE: 0x8         FILE:                     /mnt/f2fs//db0/MANIFEST-000005  EXTID:    1/1
***** EXTENT:  PBAS: 0xc4a358    PBAE: 0xc4a368    SIZE: 0x10        FILE:                                 /mnt/f2fs//db0/LOG  EXTID:    2/2

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 3146  PBAS: 0xc4a000    PBAE: 0xc4b000    SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0xc4a368    PBAE: 0xc4b000    SIZE: 0x1000      FILE:                         /mnt/f2fs//wal0/000008.log  EXTID:    1/1

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
>>>>> SEGMENT RANGE: 3147-3339   PBAS: 0xc4b000    PBAE: 0xd0c000    SIZE: 0xc1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0xc4b000    PBAE: 0xd0c000    SIZE: 0xc1000     FILE:                         /mnt/f2fs//wal0/000008.log  EXTID:    1/1

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 3340  PBAS: 0xd0c000    PBAE: 0xd0d000    SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0xd0c000    PBAE: 0xd0c6d8    SIZE: 0x6d8       FILE:                         /mnt/f2fs//wal0/000008.log  EXTID:    1/1
--------------------------------------------------------------------------------------------------------------------------------------------

============ ZONE 8 ============
LBAS: 0x1c00000  LBAE: 0x1e1a800  CAP: 0x21a800  WP: 0x2000000  SIZE: 0x400000  STATE: 0xe0  MASK: 0xffc00000

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
>>>>> SEGMENT RANGE: 7168-7217   PBAS: 0x1c00000   PBAE: 0x1c32000   SIZE: 0x32000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x1c00000   PBAE: 0x1c32000   SIZE: 0x32000     FILE:                          /mnt/f2fs//db0/000009.sst  EXTID:    3/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 7218  PBAS: 0x1c32000   PBAE: 0x1c33000   SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x1c32000   PBAE: 0x1c32ff8   SIZE: 0xff8       FILE:                          /mnt/f2fs//db0/000009.sst  EXTID:    3/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 7218  PBAS: 0x1c32000   PBAE: 0x1c33000   SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x1c32ff8   PBAE: 0x1c33000   SIZE: 0x1000      FILE:                                     /mnt/f2fs//fio  EXTID:    2/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
>>>>> SEGMENT RANGE: 7219-7542   PBAS: 0x1c33000   PBAE: 0x1d77000   SIZE: 0x144000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x1c33000   PBAE: 0x1d77000   SIZE: 0x144000    FILE:                                     /mnt/f2fs//fio  EXTID:    2/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 7543  PBAS: 0x1d77000   PBAE: 0x1d78000   SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x1d77000   PBAE: 0x1d77ee0   SIZE: 0xee0       FILE:                                     /mnt/f2fs//fio  EXTID:    2/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 7543  PBAS: 0x1d77000   PBAE: 0x1d78000   SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x1d77ee0   PBAE: 0x1d78000   SIZE: 0x1000      FILE:                          /mnt/f2fs//db0/000009.sst  EXTID:    1/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
>>>>> SEGMENT RANGE: 7544-7705   PBAS: 0x1d78000   PBAE: 0x1e1a000   SIZE: 0xa2000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x1d78000   PBAE: 0x1e1a000   SIZE: 0xa2000     FILE:                          /mnt/f2fs//db0/000009.sst  EXTID:    1/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 7706  PBAS: 0x1e1a000   PBAE: 0x1e1b000   SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x1e1a000   PBAE: 0x1e1a800   SIZE: 0x800       FILE:                          /mnt/f2fs//db0/000009.sst  EXTID:    1/3
--------------------------------------------------------------------------------------------------------------------------------------------

============ ZONE 9 ============
LBAS: 0x2000000  LBAE: 0x221a800  CAP: 0x21a800  WP: 0x20b9120  SIZE: 0x400000  STATE: 0x20  MASK: 0xffc00000

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
>>>>> SEGMENT RANGE: 8192-8376   PBAS: 0x2000000   PBAE: 0x20b9000   SIZE: 0xb9000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x2000000   PBAE: 0x20b9000   SIZE: 0xb9000     FILE:                                     /mnt/f2fs//fio  EXTID:    3/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 8377  PBAS: 0x20b9000   PBAE: 0x20ba000   SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x20b9000   PBAE: 0x20b9120   SIZE: 0x120       FILE:                                     /mnt/f2fs//fio  EXTID:    3/3
--------------------------------------------------------------------------------------------------------------------------------------------

============ ZONE 10 ============
LBAS: 0x2400000  LBAE: 0x261a800  CAP: 0x21a800  WP: 0x2432ff8  SIZE: 0x400000  STATE: 0x20  MASK: 0xffc00000

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
>>>>> SEGMENT RANGE: 9216-9264   PBAS: 0x2400000   PBAE: 0x2431000   SIZE: 0x31000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x2400000   PBAE: 0x2431000   SIZE: 0x31000     FILE:                          /mnt/f2fs//db0/000009.sst  EXTID:    2/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 9265  PBAS: 0x2431000   PBAE: 0x2432000   SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x2431000   PBAE: 0x2432000   SIZE: 0x1000      FILE:                                     /mnt/f2fs//fio  EXTID:    1/3

____________________________________________________________________________________________________________________________________________
--------------------------------------------------------------------------------------------------------------------------------------------
SEGMENT: 9266  PBAS: 0x2432000   PBAE: 0x2433000   SIZE: 0x1000
--------------------------------------------------------------------------------------------------------------------------------------------
***** EXTENT:  PBAS: 0x2432000   PBAE: 0x2432ff8   SIZE: 0xff8       FILE:                                     /mnt/f2fs//fio  EXTID:    1/3
```
